# DMA 2.0
Database Migration Assessment (DMA) tool, written in Python language to analyse the Oracle database schema objects for migration to **EDB Postgres**. Oracle Schema Objects are analyzed syntactically to find incompatibillity using a Parser written in **Antlr4 Grammar** for EDB Postgres and data stored in Python **Pandas** DataFrames.  Later incompatibility data of schema will be classified into Migration Stages with a **Assessment HTML/LOG** reports to provide a clear picture of what all can be automatically migrated without modification and what needs modification for a successfull migration. 

Migration Stages classification

|Stages|Description|
|------|-----------|
|`0`|Automatic migration. No changes are needed. EDB MTK can convert these objects automatically without any impact to database or application functionality|
|`1`|A manual intervention is needed to change the syntax. The functionality remain the same|
|`2`|Behaviorally difference, hence application logic need to be changed|
|`3`|Solution exist to achieve the similar functionality in EPAS|
|`4`|Not Supported, alternative solution need to be used either rewrite or alternative method|

### Features
* In built EDB Postgres Parser written Antlr4 Grammar
* Runs on Linux/Mac OS
* Source database version can be from Oracle 8i to Oracle 12c
* Target database version EPAS 9.6
* Two methods of assessment CONNECTION(using connection) and SQLFILE(without connection) Assessment
* Single Object or ALL objects assessment allowed in both methods of assessment
* Easy,effecient and flexible Python framework to plug any database Parser for assessment
* ONLY SQL statement(SELECT/INSERT/DELETE/UPDATE) parsing.
* Very defined HTML and Assessment Log report


### Getting Started
Below instruction will get you a copy of the DMA source code up and running on your local machine for testing purpose. DMA 2.0 has two methods to do assessment with various options.
* __**Using Oracle Database Connectivity**__ - In this method, DMA tool depends on Oracle Instant Client, Python cx_Oracle and connectivity User should have SELECT ANY DICTIONARY privilege.
* __**SQL file**__ - No connection required to Oracle Database and modules. Pass the IMPDP generated sql file or custom SQL file

#### Prerequisite
1. Python 3.x
2. Python Modules - argparse,cx_Oracle, Pandas,collection,pip,python-devel,libaio,bc,flex
Install all modules using pip (eg:- pip install cx_Oracle Pandas)
3. Download [Oracle Instant Client](http://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html) zip version of Oracle Database version (Ignore this, if assessment is SQL file method)

### Installing
- Download a zip or clone the DMA v2 repository to a directory (eg:- /usr/local/dma2)
- **For connectin method usage**
-- Make sure user has **SELECT ANY DICTIONARY** privilege on Oracle Database
-- Unzip Oracle Instant Client Zip file to a directory (eg: /opt/OracleInClient)
-- Set the environment variables
export ORACLE_HOME=/opt/OracleInClient
export LD_LIBRARY_PATH=$ORACLE_HOME
- **For SQL File method usage**
-- Pass the custom SQL file which has object definition or
-- Run IMPDP on a EXPDP dump file to generate SQL file without storage and tablespace information.
impdp userid=username/password directory=dumpfile_directory dumpfile=expdp_dmp_file sqlfile=sqlfile_name.sql transform=segment_attributes:n,STORAGE:n

Example
```
cd /usr/local/dma2
git clone https://github.com/EnterpriseDB/dmat-v2.git
cd /opt/OracleInClient
unzip /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip
unzip /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip
export ORACLE_HOME=/opt/OracleInClient
export LD_LIBRARY_PATH=$ORACLE_HOME
export PATH=$ORACLE_HOME:$PATH
```
### Running the tool 
```
Raghav-Mac:dma2 raghavendra.rao$ ./edb-dmat.py
usage: use "edb-dmat --help" for more information

EDB Database Migration Assessment tool

optional arguments:
  -h, --help      show this help message and exit
  -v, --version   DMA Tool binary version
  -c , --conn     Oracle Connection String in the format
                  'username/password@host:port/sid-or-service'
  -S , --sql      Pass Oracle SQL Dump file generated by IMPDP/DBMS_METADATA
  -O , --object   Oracle Object ['ALL', 'CLUSTER', 'FUNCTION', 'INDEX', 'JAVA
                  CLASS', 'JOBLOB', 'PACKAGE', 'PACKAGE BODYPROCEDURE',
                  'PROGRAM', 'SEQUENCE', 'SYNONYM', 'TABLE', 'TRIGGER',
                  'TYPE', 'TYPE BODY', 'VIEW', 'MATERIALIZED VIEWSQL'] to
                  assess from SQL Dump file
  -s , --schema   Assessment schema name
  -l , --logs     DMA html/logs location
  -r , --report   Assessment report can be any HTML or LOG or BOTH defaul:
                  BOTH
```

### Using Connection method Examples
```
--Complete assessement of a schema
edb-dmat.py -c homegate/homegate@172.16.210.131:1521/ORA11G -l /tmp -s homegate
--Single object assessment
edb-dmat.py -c homegate/homegate@172.16.210.131:1521/ORA11G -l /tmp -s homegate -O TABLE
--Only with HTML report
edb-dmat.py -c homegate/homegate@172.16.210.131:1521/ORA11G -l /tmp -s homegate -r HTML
```
### Using SQL File Method examples
```
--Complete assessment of a schema sqlfile generated from IMPDP
edb-dmat.py -S scott.sql -l /tmp -O ALL
--Single Object assessment
edb-dmat.py -S scott.sql -l /tmp -O TABLE
--Only with HTML report
edb-dmat.py -S scott.sql -l /tmp -O TABLE -r HTML
```

### Steps for CONTRIBUTORS to build the antlr Parser/Lexer
- [Install antlr4-runtime module for python](http://www.antlr.org/download.html)
- Run below script whenever you modify the ora2epas.g4 file to generate the new Parser/Lexer/Listener
```
Raghav-Mac:antlr4python raghavendra.rao$ more antlr4-builder.sh
#!/bin/bash
rm -f *.pye *Lexer.py *Parser.py *Listener.py *.pyc *.tokens *.java *.class
antlr4='java -jar /usr/local/lib/antlr-4.7-complete.jar'
$antlr4 -Dlanguage=Python3 "$@"
```
```
cd dma2/parser/ora2epas
sh $HOME/antlr4-builder.sh ora2epas.g4
```

## Author
* **Raghavendra Rao** - Author, Initial Framework design, contributor,Reviewer

## Contributors
* Raghavendra Rao

Please read [contributing.md](dma-v2/contributing.md) for details on our code of conduct, and the process for submitting pull requests to EDB DMA project.

## License
This project is licensed under the EDB License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgments
* Inspired by Antlr4 Grammar 
